@{
    var currentController = ViewContext.RouteData.Values["controller"]?.ToString();
    var currentAction = ViewContext.RouteData.Values["action"]?.ToString();
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>@ViewData["Title"] - GlassCodeTech_Ticketing_System_Project</title>
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/stylelogin.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/GlassCodeTech_Ticketing_System_Project.styles.css" asp-append-version="true" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

</head>
<body>

@*     @if (!(currentController == "Login" && currentAction == "Login"))
    {
        @Html.Partial("_headerPartial")
    }
    @if (!(currentController == "Registration" && currentAction == "Register"))
    {
        @Html.Partial("_headerPartial")
    } *@
    @Html.Partial("_headerPartial")
    <div class="container">
        <main role="main" class="pb-3">
            @RenderBody()
        </main>
    </div>

    <!-- Notification Bell -->
    <div class="notification-container position-relative">
        <button id="notificationBell" class="btn btn-link position-relative">
            <i class="fas fa-bell"></i>
            <span id="notificationCount" class="position-absolute top-0 start-100 translate-middle badge rounded-pill bg-danger" style="display:none;">0</span>
        </button>

        <!-- Notification Dropdown -->
        <div id="notificationDropdown" class="dropdown-menu notification-dropdown" style="display:none; width: 300px; max-height: 400px; overflow-y: auto;">
            <h6 class="dropdown-header">Notifications</h6>
            <div id="notificationList">
                <!-- Notifications will be loaded here -->
            </div>
            <div class="dropdown-divider"></div>
            <button id="markAllRead" class="dropdown-item text-center">Mark All Read</button>
        </div>
    </div>


    <footer class="border-top footer text-muted mt-auto py-3">
        <div class="container text-center">
            &copy; 2025 - GlassCodeTech_Ticketing_System_Project - <a asp-area="" asp-controller="Home" asp-action="Privacy">Privacy</a>
        </div>
    </footer>
    @section Scripts {
        <script>
            $(document).ready(function() {
                loadNotifications();
                setInterval(loadNotifications, 30000); // Check every 30 seconds

                $('#notificationBell').click(function() {
                    $('#notificationDropdown').toggle();
                });

                $('#markAllRead').click(function() {
                    $.post('@Url.Action("MarkAllRead", "Notification")', function(response) {
                        if (response.success) {
                            $('#notificationCount').hide();
                            $('#notificationList').html('<p class="text-center text-muted">No new notifications</p>');
                        }
                    });
                });

                // Close dropdown when clicking outside
                $(document).click(function(event) {
                    if (!$(event.target).closest('.notification-container').length) {
                        $('#notificationDropdown').hide();
                    }
                });
            });

            function loadNotifications() {
                $.get('@Url.Action("GetUnread", "Notification")', function(response) {
                    if (response.success) {
                        var count = response.data.length;
                        if (count > 0) {
                            $('#notificationCount').text(count).show();
                            var html = '';
                            response.data.forEach(function(notification) {
                                html += '<div class="dropdown-item-text small">' +
                                       '<div class="fw-bold">' + notification.notification_type_name + '</div>' +
                                       '<div>' + notification.message.substring(0, 100) + '...</div>' +
                                       '<div class="text-muted">' + new Date(notification.sent_at).toLocaleString() + '</div>' +
                                       '</div><div class="dropdown-divider"></div>';
                            });
                            $('#notificationList').html(html);
                        } else {
                            $('#notificationCount').hide();
                            $('#notificationList').html('<p class="text-center text-muted">No new notifications</p>');
                        }
                    }
                });
            }
        </script>
    }

    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    <script src="~/js/register-validation.js"></script>
    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
