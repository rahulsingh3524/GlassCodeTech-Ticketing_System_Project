@{
    var currentController = ViewContext.RouteData.Values["controller"]?.ToString();
    var currentAction = ViewContext.RouteData.Values["action"]?.ToString();
}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>@ViewData["Title"] - GlassCodeTech_Ticketing_System_Project</title>
    <!-- LOCAL CSS/JS (remove \ slashes from ~ paths) -->
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/css/stylelogin.css" asp-append-version="true" />
    <link rel="stylesheet" href="~/GlassCodeTech_Ticketing_System_Project.styles.css" asp-append-version="true" />
    <!-- CDN CSS (optional for latest Bootstrap/icons) -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" />
</head>
<body>
    @Html.Partial("_headerPartial")
    <div class="container">
        <main role="main" class="pb-3">
            @RenderBody()
        </main>
    </div>
    
    <footer class="border-top footer text-muted mt-auto py-3">
        <div class="container text-center">
            &copy; 2025 - GlassCodeTech_Ticketing_System_Project - <a asp-area="" asp-controller="Home" asp-action="Privacy">Privacy</a>
        </div>
    </footer>

    <!-- --- Scripts: Always load jQuery BEFORE your custom scripts! --- -->
    <!-- DataTables & Buttons CSS (put these in <head> or _Layout.cshtml once) -->
    <link rel="stylesheet" href="~/plugins/datatables-responsive/css/responsive.bootstrap4.min.css" />
    <!-- DataTables + Buttons Required JS (include in layout or here before </body>) -->
    <!-- In Scripts section or _Layout.cshtml -->
    <link rel="stylesheet" href="~/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css" />
    <link rel="stylesheet" href="~/plugins/datatables-buttons/css/buttons.bootstrap4.min.css" />
    <script src="~/plugins/jquery/jquery.min.js"></script>
    <script src="~/plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="~/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
    <script src="~/plugins/datatables-buttons/js/dataTables.buttons.min.js"></script>
    <script src="~/plugins/datatables-buttons/js/buttons.bootstrap4.min.js"></script>
    <script src="~/plugins/jszip/jszip.min.js"></script>
    <script src="~/plugins/pdfmake/pdfmake.min.js"></script>
    <script src="~/plugins/pdfmake/vfs_fonts.js"></script>
    <script src="~/plugins/datatables-buttons/js/buttons.html5.min.js"></script>
    <script src="~/plugins/datatables-buttons/js/buttons.print.min.js"></script>
    <script src="~/plugins/datatables-buttons/js/buttons.colVis.min.js"></script>
    <script src="~/dist/js/adminlte.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/js/site.js" asp-append-version="true"></script>
    <script src="~/js/register-validation.js"></script>



    <script>
        $(document).ready(function () {
            loadNotifications();

            // Auto-refresh notifications every 30s
            setInterval(loadNotifications, 30000);

            // Toggle dropdown on bell click
            $('#notificationBell').click(function (e) {
                $('#notificationDropdown').toggle();
                e.stopPropagation();
            });

            // Mark all read
            $(document).on('click', '#markAllRead', function () {
                $.post('@Url.Action("MarkAllRead", "Notification")', function (response) {
                    if (response.success) {
                        $('#notificationCount').hide();
                        $('#notificationList').html(`
                            <div class="notification-header">Notifications</div>
                            <div class="notification-empty">No new notifications</div>
                        `);
                    }
                });
            });

            // Hide dropdown when clicking outside
            $(document).click(function (event) {
                if (!$(event.target).closest('.notification-container').length) {
                    $('#notificationDropdown').hide();
                }
            });
        });

        function loadNotifications() {
            $.get('@Url.Action("GetUnread", "Notification")', function (response) {
                if (response.success) {
                    var count = response.data.length;
                    if (count > 0) {
                        $('#notificationCount').text(count).show();

                        var html = '<div class="notification-header">Notifications</div>';
                        response.data.forEach(function (notification) {
                            html += `
                                <div class="notification-item">
                                    <div class="notification-title">
                                        <i class="bi bi-dot"></i> ${notification.notification_type_name}
                                    </div>
                                    <div class="notification-message">
                                        ${(notification.message && notification.message.length > 120
                                            ? notification.message.substring(0, 120) + '...'
                                            : notification.message || '')}
                                    </div>
                                    <div class="notification-time">
                                        <i class="bi bi-clock"></i> ${new Date(notification.sent_at).toLocaleString()}
                                    </div>
                                </div>`;
                        });

                        html += `
                            <div class="notification-footer">
                                <button id="markAllRead" class="btn btn-outline-primary btn-sm">Mark All Read</button>
                            </div>
                        `;

                        $('#notificationList').html(html);

                    } else {
                        $('#notificationCount').hide();
                        $('#notificationList').html(`
                            <div class="notification-header">Notifications</div>
                            <div class="notification-empty">No new notifications</div>
                        `);
                    }
                }
            });
        }
    </script>


    <link rel="stylesheet" href="~/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css" />
    <link rel="stylesheet" href="~/plugins/datatables-responsive/css/responsive.bootstrap4.min.css" />
    <link rel="stylesheet" href="~/plugins/datatables-buttons/css/buttons.bootstrap4.min.css" />

    <script src="~/plugins/jquery/jquery.min.js"></script>
    <script src="~/plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="~/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
    <script src="~/plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
    <script src="~/plugins/datatables-responsive/js/responsive.bootstrap4.min.js"></script>
    <script src="~/plugins/datatables-buttons/js/dataTables.buttons.min.js"></script>
    <script src="~/plugins/datatables-buttons/js/buttons.bootstrap4.min.js"></script>
    <script src="~/plugins/jszip/jszip.min.js"></script>
    <script src="~/plugins/pdfmake/pdfmake.min.js"></script>
    <script src="~/plugins/pdfmake/vfs_fonts.js"></script>
    <script src="~/plugins/datatables-buttons/js/buttons.html5.min.js"></script>
    <script src="~/plugins/datatables-buttons/js/buttons.print.min.js"></script>
    <script src="~/plugins/datatables-buttons/js/buttons.colVis.min.js"></script>
    <script src="~/dist/js/adminlte.min.js"></script>


    @await RenderSectionAsync("Scripts", required: false)
</body>
</html>
