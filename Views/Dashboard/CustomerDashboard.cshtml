@{
    ViewData["Title"] = "Customer Dashboard";
}

<div class="container mt-5">
    <h2 class="mb-4">Customer Dashboard</h2>

    <div class="row">
        <div class="col-md-4 mb-3">
            <div class="card h-100 shadow-sm">
                <div class="card-body d-flex flex-column justify-content-center align-items-center">
                    <h5 class="card-title mb-3">Raise New Ticket</h5>
                    <a href="@Url.Action("Create", "Ticket")" class="btn btn-primary w-100">New Ticket</a>
                </div>
            </div>
        </div>

        <div class="col-md-4 mb-3">
            <div class="card h-100 shadow-sm">
                <div class="card-body d-flex flex-column justify-content-center align-items-center">
                    <h5 class="card-title mb-3">Track Current Tickets</h5>
                    <a href="@Url.Action("Track", "Ticket")" class="btn btn-info w-100">Track Ticket</a>
                </div>
            </div>
        </div>

        <div class="col-md-4 mb-3">
            <div class="card h-100 shadow-sm">
                <div class="card-body d-flex flex-column justify-content-center align-items-center">
                    <h5 class="card-title mb-3">Closed/Resolved Tickets</h5>
                    <a href="@Url.Action("Closed", "Ticket")" class="btn btn-secondary w-100">View Closed Tickets</a>
                </div>
            </div>
        </div>
    </div>

    <div class="mt-4">
        <h4>Your Recent Tickets</h4>
        <table class="table table-bordered">
            <thead>
                <tr>
                    <th>Ticket ID</th>
                    <th>Subject</th>
                    <th>Status</th>
                    <th>Created At</th>
                    <th>Actions</th>
                </tr>
            </thead>
            <tbody id="recentTicketsBody">
                <tr><td colspan="5" class="text-center">Loading...</td></tr>
            </tbody>
        </table>
    </div>

    @section Scripts {
        <script>
            $(document).ready(function () {
                $.ajax({
                    type: "GET",
                    url: '@Url.Action("GetRecentTickets", "Ticket")',
                    success: function (response) {
                        var tb = $("#recentTicketsBody");
                        tb.empty();
                        if (response.success && response.data && response.data.length > 0) {
                            $.each(response.data, function (i, ticket) {
                                var viewUrl = '@Url.Action("Details", "Ticket")' + '?id=' + ticket.id;
                                var row = "<tr>" +
                                    "<td>" + ticket.ticket_id + "</td>" +
                                    "<td>" + ticket.subject + "</td>" +
                                    "<td>" + ticket.status + "</td>" +
                                    "<td>" + ticket.created_at + "</td>" +
                                    "<td><a href='" + viewUrl + "' class='btn btn-sm btn-outline-info'>View</a></td>" +
                                    "</tr>";
                                tb.append(row);
                            });
                        } else {
                            tb.append('<tr><td colspan="5" class="text-center">No recent tickets found.</td></tr>');
                        }
                    },
                    error: function () {
                        $("#recentTicketsBody").html('<tr><td colspan="5" class="text-danger text-center">Failed to load tickets.</td></tr>');
                    }
                });
            });
        </script>
    }
